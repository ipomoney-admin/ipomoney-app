<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPO Analysis - Ipomoney.in</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { font-size: 16px; }
        body { font-family: sans-serif; line-height: 1.6; margin: 0; padding: 0; background: #f9f9f9; color: #333; transition: 0.3s; }
        header { background: #003366; color: white; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
        .container { max-width: 900px; margin: 20px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .hero { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #007bff; padding-bottom: 15px; margin-bottom: 25px; }
        .gmp-box { background: #2e7d32; color: white; padding: 10px 20px; border-radius: 6px; font-weight: bold; font-size: 1.2rem; }
        h2 { color: #007bff; border-left: 5px solid #007bff; padding-left: 12px; margin: 30px 0 15px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #eee; }
        .metrics-grid div { font-size: 0.95rem; }
        .btn-group { display: flex; gap: 15px; margin-top: 30px; }
        .btn { flex: 1; text-align: center; padding: 14px; border-radius: 6px; text-decoration: none; font-weight: bold; color: white; }
        .btn-rhp { background: #d32f2f; }
        .btn-anchor { background: #455a64; }
        .faq-section { background: #fffde7; padding: 20px; border-radius: 8px; border: 1px solid #fff176; white-space: pre-line; }
    </style>
</head>
<body>

<header>
    <span style="font-size: 20px; font-weight: bold; cursor: pointer;" onclick="location.href='index.html'">Ipomoney</span>
    <button onclick="toggleTheme()" style="background:none; border:1px solid white; color:white; padding:4px 10px; border-radius:4px; cursor:pointer;">ðŸŒ— Theme</button>
</header>

<div class="container">
    <div class="hero">
        <div>
            <h1 id="ipoName" style="margin:0;">Loading...</h1>
            <p id="ipoId" style="color:#777; margin:5px 0 0;"></p>
        </div>
        <div class="gmp-box" id="ipoGmp">GMP: --</div>
    </div>

    <div class="metrics-grid">
        <div><strong>Issue Size:</strong> â‚¹<span id="issueSize">--</span> Cr</div>
        <div><strong>Type:</strong> <span id="ipoType">--</span></div>
        <div><strong>Fresh Issue:</strong> â‚¹<span id="freshIssue">--</span> Cr</div>
        <div><strong>OFS:</strong> â‚¹<span id="ofsSize">--</span> Cr</div>
        <div><strong>P/E Ratio:</strong> <span id="peRatio">--</span></div>
        <div><strong>ROE:</strong> <span id="roeValue">--</span>%</div>
    </div>

    <h2>Business & Operations</h2>
    <p id="businessDesc">Fetching data...</p>

    <h2>Promoter Details</h2>
    <p id="promoterDesc">Fetching data...</p>

    <h2>FAQ & Lot Details</h2>
    <div class="faq-section" id="faqContent">Loading FAQs...</div>

    <div class="btn-group">
        <a id="rhpLink" href="#" class="btn btn-rhp" target="_blank">ðŸ“„ Download RHP</a>
        <a id="anchorLink" href="#" class="btn btn-anchor" target="_blank">âš“ Anchor List</a>
    </div>
</div>

<script>
    const supabase = supabase.createClient('https://khnuyrhafzppbugebjdn.supabase.co', 'sb_publishable_JZ37y6ufdYYqJK9U4MK7Dg_doZJE6dp');

    async function getDetails() {
        const idParam = new URLSearchParams(window.location.search).get('id');
        if (!idParam) return;
        const year = parseInt(idParam.substring(0, 2));
        const seq = parseInt(idParam.substring(2));

        const { data, error } = await supabase.from('ipos').select('*').eq('year', year).eq('sequence_no', seq).single();
        if (error || !data) { document.getElementById('ipoName').innerText = "Not Found"; return; }

        document.getElementById('ipoName').innerText = data.name;
        document.getElementById('ipoId').innerText = `Listing ID: ${idParam}`;
        document.getElementById('ipoGmp').innerText = `GMP: â‚¹${data.gmp}`;
        document.getElementById('issueSize').innerText = data.issue_size;
        document.getElementById('ipoType').innerText = data.ipo_type;
        document.getElementById('freshIssue').innerText = data.fresh_issue;
        document.getElementById('ofsSize').innerText = data.ofs;
        document.getElementById('businessDesc').innerText = data.business_operations;
        document.getElementById('promoterDesc').innerText = data.promoters;
        document.getElementById('faqContent').innerText = data.faqs || "FAQs will be updated soon.";
        
        const f = data.fundamentals || {};
        document.getElementById('peRatio').innerText = f.pe || '--';
        document.getElementById('roeValue').innerText = f.roe || '--';

        if(data.rhp_url) document.getElementById('rhpLink').href = data.rhp_url;
        if(data.anchor_url) document.getElementById('anchorLink').href = data.anchor_url;
    }

    function toggleTheme() {
        const isDark = document.body.style.backgroundColor === 'rgb(34, 34, 34)';
        document.body.style.backgroundColor = isDark ? '#f9f9f9' : '#222';
        document.body.style.color = isDark ? '#333' : '#eee';
        document.querySelector('.container').style.background = isDark ? 'white' : '#333';
    }

    getDetails();
</script>
</body>
</html>
