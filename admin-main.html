<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ipomoney Admin - Relational</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .box { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { background: #007bff; color: white; padding: 15px; width: 100%; border: none; cursor: pointer; font-size: 16px; font-weight: bold; }
        h3 { border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    </style>
</head>
<body>
<div class="box">
    <h2>Ipomoney Master Entry</h2>
    
    <h3>1. Main Offer</h3>
    <div class="grid">
        <input type="text" id="company_name" placeholder="Company Name">
        <input type="text" id="slug" placeholder="slug-url">
        <select id="ipo_type"><option value="Mainboard">Mainboard</option><option value="SME">SME</option></select>
        <input type="number" id="year" value="26">
        <input type="number" id="sequence_no" placeholder="Seq No (01)">
        <input type="number" id="issue_size" placeholder="Issue Size (Cr)">
    </div>

    <h3>2. Timeline</h3>
    <div class="grid">
        <input type="date" id="open_date">
        <input type="date" id="close_date">
        <input type="date" id="listing_date">
    </div>

    <h3>3. Financials</h3>
    <div class="grid">
        <input type="text" id="fin_year" placeholder="FY 2025">
        <input type="number" id="revenue" placeholder="Revenue (Cr)">
        <input type="number" id="pat" placeholder="PAT (Profit Cr)">
    </div>

    <button onclick="saveData()">ðŸš€ Push to All Tables</button>
    <p id="msg" style="text-align:center; font-weight:bold;"></p>
</div>

<script>
    const client = window.supabase.createClient('https://khnuyrhafzppbugebjdn.supabase.co', 'sb_publishable_JZ37y6ufdYYqJK9U4MK7Dg_doZJE6dp');

    async function saveData() {
        const msg = document.getElementById('msg');
        msg.innerText = "Processing...";

        try {
            // Table 1: ipo_offers
            const { data: offer, error: e1 } = await client.from('ipo_offers').upsert({
                company_name: document.getElementById('company_name').value,
                slug: document.getElementById('slug').value,
                ipo_type: document.getElementById('ipo_type').value,
                year: parseInt(document.getElementById('year').value),
                sequence_no: parseInt(document.getElementById('sequence_no').value),
                issue_size_rs: parseFloat(document.getElementById('issue_size').value)
            }, { onConflict: 'slug' }).select().single();

            if (e1) throw e1;
            const ipoId = offer.id;

            // Table 2: ipo_timeline
            await client.from('ipo_timeline').upsert({
                ipo_id: ipoId,
                open_date: document.getElementById('open_date').value || null,
                close_date: document.getElementById('close_date').value || null,
                listing_date: document.getElementById('listing_date').value || null
            }, { onConflict: 'ipo_id' });

            // Table 3: company_financials
            await client.from('company_financials').upsert({
                ipo_id: ipoId,
                financial_year: document.getElementById('fin_year').value,
                revenue: parseFloat(document.getElementById('revenue').value),
                pat: parseFloat(document.getElementById('pat').value)
            }, { onConflict: 'ipo_id' });

            alert("âœ… Data Saved in all Tables!");
            msg.innerText = "Success!";
        } catch (err) {
            alert("Error: " + err.message);
            msg.innerText = "Error: " + err.message;
        }
    }
</script>
</body>
</html>
